@(implicit request: play.api.mvc.RequestHeader)
@import helper.CSRF

@main("Lobby") {

  <style>

    .checker-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
}

/* White piece */
.checker-white {
  background: radial-gradient(circle at 30% 30%, #fff, #cfcfcf);
  border: 1px solid #b5b5b5;
}

/* Black piece */
.checker-black {
  background: radial-gradient(circle at 30% 30%, #444, #000);
}

/* Half-and-half random piece */
.checker-random {
  background: linear-gradient(90deg,
      #fff 0%, #fff 50%, 
      #000 50%, #000 100%
  );
  border: 1px solid #777;
}


.option-card {
  border: 1px solid;
  transition: border-color 0.2s, box-shadow 0.2s;
}

/* Selected card (radio checked) */
input[name="boardSize"]:checked + .option-card {
  border: 2px solid var(--bs-primary);
  box-shadow: 0 0 10px rgba(0, 123, 255, 0.3);
}
input[name="playerColor"]:checked + .option-card {
  border: 2px solid var(--bs-primary);
  box-shadow: 0 0 10px rgba(0, 123, 255, 0.3);
}

.gamified-header {
  font-family: 'Orbitron', sans-serif; /* futuristic font */
  font-size: 3rem;
  color: var(--bs-primary);
  background: linear-gradient(90deg, var(--bs-primary), #3a0ca3);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: 2px;
  position: relative;
  display: inline-block;
}

  </style>
  <main class="container py-5">

    <div class="text-center my-4">
  <h1 class="gamified-header">
    Backgammon
  </h1>
</div>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@@700&display=swap" rel="stylesheet">

<div class="row justify-content-center mb-4">
  <div class="col-12 col-md-10 col-lg-8">
    <input type="text" id="playerName" name="playerName" class="form-control" 
           placeholder="Enter your name" required 
           value="@request.session.get("username").getOrElse("")">
  </div>
</div>



<script>
$(document).ready(function() {
  const csrfToken = '@CSRF.getToken.value';

  $('#playerName').on('change', function() {
    $.post({
      url: '/update-username',
      data: { username: $(this).val() },
      headers: { 'Csrf-Token': csrfToken },
      success: function() { console.log('Username saved to session'); },
      error: function() { console.error('Failed to save username'); }
    });
  });

      document.getElementById("createLobby").addEventListener("click", async () => {
      const csrfToken = '@CSRF.getToken.value';

      const username = document.getElementById("playerName").value;
      if (!username) return alert("Enter a username");

      // Get selected board size
      const boardSizeInput = document.querySelector('input[name="boardSize"]:checked');
      const boardSize = boardSizeInput ? boardSizeInput.value : null;

      // Get selected scope
      const scopeInput = document.querySelector('input[name="scope"]:checked');
      const scope = scopeInput ? scopeInput.value : null;

      // Get selected scope
      const playerInput = document.querySelector('input[name="playerColor"]:checked');
      const player = playerInput ? playerInput.value : null;


      const response = await fetch("/lobby", {
        method: "POST",
        headers: { 
          "Content-Type": "application/x-www-form-urlencoded",
          "Csrf-Token": csrfToken
        },
        body: new URLSearchParams({             
          scope, 
          boardSize,
          player
        })
      });

      if (response.redirected) {
        window.location.href = response.url; // Redirect to /lobby/lobbyId
      } else {
        const data = await response.text();
        alert("Error: " + data);
      }
    });
});
</script>

<div class="row justify-content-center g-4 mt-4">

  <!-- Start a new game (2/3 width on large screens) -->
  <div class="col-12 col-lg-8">
    <div class="card card-lobby p-4">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
          <h3 class="mb-0">Start a new game</h3>
          <div class="muted-sm">Prepare your game and invite friends — or go public and match with players.</div>
        </div>
        <div class="text-end">
          <small class="text-muted">Preview</small>
          <div id="previewBadge" class="d-inline-block ms-2 badge bg-light text-dark">
            Classic • Public
          </div>
        </div>
      </div>

      <form id="lobbyForm" class="row g-3">

        <!-- Board size -->
        <div class="col-12">
          <label class="form-label fw-semibold">Board size</label>

          <div class="row row-cols-1 row-cols-sm-3 g-3">

            <div class="col">
              <input type="radio" class="btn-check" name="boardSize" id="sizeSmall" value="Small" autocomplete="off">
              <label class="option-card card p-3 text-center h-100 d-block" for="sizeSmall" style="cursor: pointer;">
                <div class="mb-2"><i class="bi bi-arrows-angle-contract fs-2"></i></div>
                <div class="fw-bold">Small</div>
                <div class="muted-sm">Quick rounds, great for beginners</div>
              </label>
            </div>

            <div class="col">
              <input type="radio" class="btn-check" name="boardSize" id="sizeMedium" value="Medium" autocomplete="off">
              <label class="option-card card p-3 text-center h-100 d-block" for="sizeMedium" style="cursor: pointer;">
                <div class="mb-2"><i class="bi bi-grid-3x3-gap fs-2"></i></div>
                <div class="fw-bold">Medium</div>
                <div class="muted-sm">Balanced playtime and strategy</div>
              </label>
            </div>

            <div class="col">
              <input type="radio" class="btn-check" name="boardSize" id="sizeClassic" value="Classic" autocomplete="off" checked>
              <label class="option-card card p-3 text-center h-100 d-block" for="sizeClassic" style="cursor: pointer;">
                <div class="mb-2"><i class="bi bi-grid fs-2"></i></div>
                <div class="fw-bold">Classic</div>
                <div class="muted-sm">The original and most balanced board</div>
              </label>
            </div>

          </div>
        </div>

        <!-- Your play as -->
        <div class="col-12">
          <label class="form-label fw-semibold">Your play as</label>

          <div class="row row-cols-3 g-3">

            <!-- White -->
            <div class="col">
              <input type="radio" class="btn-check" name="playerColor" id="colorWhite" value="White" autocomplete="off" checked>
              <label class="option-card card p-3 text-center h-100 d-flex align-items-center justify-content-center" 
                    for="colorWhite" style="cursor: pointer;">
                <div class="checker-icon checker-white"></div>
              </label>
            </div>

            <!-- Black -->
            <div class="col">
              <input type="radio" class="btn-check" name="playerColor" id="colorBlack" value="Black" autocomplete="off">
              <label class="option-card card p-3 text-center h-100 d-flex align-items-center justify-content-center" 
                    for="colorBlack" style="cursor: pointer;">
                <div class="checker-icon checker-black"></div>
              </label>
            </div>

            <!-- Random -->
            <div class="col">
              <input type="radio" class="btn-check" name="playerColor" id="colorRandom" value="Random" autocomplete="off">
              <label class="option-card card p-3 text-center h-100 d-flex align-items-center justify-content-center" 
                    for="colorRandom" style="cursor: pointer;">
                <div class="checker-icon checker-random"></div>
              </label>
            </div>

          </div>
        </div>


        <!-- Scope -->
        <div class="col-12">
          <label class="form-label fw-semibold">Scope</label>

          <div class="d-flex gap-3">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="scope" id="scopePublic" value="Public" checked>
              <label class="form-check-label" for="scopePublic" style="cursor: pointer;">
                Public <small class="text-muted">(match with players)</small>
              </label>
            </div>

            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="scope" id="scopePrivate" value="Private">
              <label class="form-check-label" for="scopePrivate" style="cursor: pointer;">
                Private <span class="badge badge-private ms-2">Play with friend</span>
              </label>
            </div>
          </div>

        </div>


        <!-- Create Button -->
        <div class="col-12 d-flex justify-content-end">
          <button id="createLobby" type="button" class="btn btn-primary">Create Lobby</button>
        </div>

      </form>
    </div>
  </div>

  <!-- Join Lobby (1/3 width on large screens) -->
  <div class="col-12 col-lg-4">
    <div class="card card-lobby p-4">

      <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
          <h3 class="mb-0">Join a lobby</h3>
          <div class="muted-sm">Enter a friend’s invite code to join their private game.</div>
        </div>
      </div>

      <div class="row g-3">

        <!-- Lobby Code Input -->
        <div class="col-12">
          <label class="form-label fw-semibold" for="joinCode">Lobby Code</label>
          <input type="text" id="joinCode" class="form-control" placeholder="Enter lobby code...">
        </div>

        <!-- Join Button -->
        <div class="col-12 d-flex justify-content-end">
          <button id="joinLobby" type="button" class="btn btn-outline-primary">
            Join Lobby
          </button>
        </div>

      </div>

    </div>
  </div>

</div>




</main>
}
